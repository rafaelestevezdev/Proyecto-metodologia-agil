<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Panel de Administración</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/dashboard.css" />
  </head>
  <body>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const sessionData = sessionStorage.getItem("currentUser");
        const loggedIn = sessionStorage.getItem("loggedIn");

        if (!loggedIn || !sessionData) {
          window.location.href = "index.html";
          return;
        }

        const user = JSON.parse(sessionData);
        if (user.role !== "admin") {
          window.location.href = "tienda-productos.html";
          return;
        }
      });
    </script>

    <div class="dashboard-container">
      <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <div class="sidebar-logo">
            <img
              src="assets/logo/nexus.png"
              alt="Nexus Logo"
              class="sidebar-logo-img"
            />
            <h2 class="sidebar-title">Nexus Admin</h2>
          </div>
          <button
            class="sidebar-toggle"
            id="sidebar-toggle"
            aria-label="Cerrar navegación"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M18 6L6 18M6 6l12 12" />
            </svg>
          </button>
        </div>

        <ul class="sidebar-menu">
          <li>
            <a href="#dashboard" class="nav-link active" data-page="dashboard"
              ><svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                <polyline points="9 22 9 12 15 12 15 22" /></svg
              ><span>Dashboard</span></a
            >
          </li>
          <li>
            <a href="#products" class="nav-link" data-page="products"
              ><svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <circle cx="9" cy="21" r="1" />
                <circle cx="20" cy="21" r="1" />
                <path
                  d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"
                /></svg
              ><span>Productos</span></a
            >
          </li>
          <li>
            <a href="#categories" class="nav-link" data-page="categories"
              ><svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <rect x="3" y="3" width="7" height="7" />
                <rect x="14" y="3" width="7" height="7" />
                <rect x="14" y="14" width="7" height="7" />
                <rect x="3" y="14" width="7" height="7" /></svg
              ><span>Categorías</span></a
            >
          </li>
          <li>
            <a href="#orders" class="nav-link" data-page="orders"
              ><svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  d="M9 1H3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2z"
                />
                <path
                  d="M21 13h-6a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-6a2 2 0 0 0-2-2z"
                />
                <line x1="3" y1="22" x2="3" y2="22.01" />
                <line x1="21" y1="2" x2="21" y2="2.01" /></svg
              ><span>Pedidos</span></a
            >
          </li>
          <li>
            <a href="#customers" class="nav-link" data-page="customers"
              ><svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                <circle cx="9" cy="7" r="4" />
                <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
                <path d="M16 3.13a4 4 0 0 1 0 7.75" /></svg
              ><span>Clientes</span></a
            >
          </li>
          <li>
            <a href="#reports" class="nav-link" data-page="reports"
              ><svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  d="M3 3v18a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1h-5V3a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1z"
                />
                <polyline points="17 17 17 1" />
                <line x1="13" y1="5" x2="13" y2="9" /></svg
              ><span>Reportes</span></a
            >
          </li>
          <li>
            <a href="#settings" class="nav-link" data-page="settings"
              ><svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <circle cx="12" cy="12" r="3" />
                <path
                  d="M12 1v6m0 6v6M4.22 4.22l4.24 4.24m3.08 3.08l4.24 4.24M1 12h6m6 0h6M4.22 19.78l4.24-4.24m3.08-3.08l4.24-4.24"
                /></svg
              ><span>Configuración</span></a
            >
          </li>
        </ul>
      </nav>

      <div class="main-content">
        <header class="header">
          <div class="header-left">
            <button class="mobile-nav-toggle" id="mobile-nav-toggle">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M3 12h18M3 6h18M3 18h18" />
              </svg>
            </button>
            <div class="search-bar">
              <input type="text" id="search-input" placeholder="Buscar..." />
            </div>
          </div>

          <div class="header-right">
            <div class="profile-menu-container">
              <button class="profile-toggle" id="profile-toggle">
                <img
                  src="https://i.pravatar.cc/150?u=administrator"
                  alt="Avatar"
                  class="profile-avatar"
                />
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <polyline points="6 9 12 15 18 9" />
                </svg>
              </button>

              <div class="profile-dropdown" id="profile-dropdown">
                <div class="profile-header">
                  <img
                    src="https://i.pravatar.cc/150?u=administrator"
                    alt="Avatar"
                    class="profile-avatar-large"
                  />
                  <div class="profile-info">
                    <div class="profile-name" id="profile-name">
                      Administrador
                    </div>
                    <div class="profile-email" id="profile-email">
                      admin@sistema.local
                    </div>
                    <div class="profile-role">Admin del Sistema</div>
                  </div>
                </div>
                <hr class="profile-divider" />
                <a
                  href="#"
                  class="profile-menu-item"
                  id="profile-menu-link"
                  onclick="ProfileAdminModule.openProfileModal(); event.preventDefault();"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                    <circle cx="12" cy="7" r="4" />
                  </svg>
                  <span>Mi Perfil</span>
                </a>
                <a href="#" class="profile-menu-item">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <circle cx="12" cy="12" r="1" />
                    <circle cx="19" cy="12" r="1" />
                    <circle cx="5" cy="12" r="1" />
                  </svg>
                  <span>Configuración</span>
                </a>
                <hr class="profile-divider" />
                <button class="profile-menu-item logout-item" id="logout-btn">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                    <polyline points="16 17 21 12 16 7" />
                    <line x1="21" y1="12" x2="9" y2="12" />
                  </svg>
                  <span>Cerrar Sesión</span>
                </button>
              </div>
            </div>
          </div>
        </header>

        <main>
          <!-- El contenido se cargará dinámicamente aquí -->
        </main>
      </div>
    </div>

    <!-- Loading Overlay para Logout -->
    <div class="loading-overlay hidden" id="logoutLoadingOverlay">
      <div class="loader">
        <span class="loader-ring"></span>
        <p class="loader-text">
          Cerrando Sesión<strong>por favor espera...</strong>
        </p>
      </div>
    </div>

    <div class="modal-overlay" id="logout-modal">
      <div class="modal-content logout-modal">
        <div class="logout-modal-icon">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="64"
            height="64"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
            <polyline points="16 17 21 12 16 7" />
            <line x1="21" y1="12" x2="9" y2="12" />
          </svg>
        </div>
        <div class="logout-modal-content">
          <h2>¿Cerrar sesión?</h2>
          <p>
            Se perderá el acceso al panel administrativo hasta que vuelvas a
            iniciar sesión.
          </p>
        </div>
        <div class="logout-modal-footer">
          <button class="btn btn-secondary" id="logout-cancel-btn">
            Cancelar
          </button>
          <button class="btn btn-danger logout-confirm" id="logout-confirm-btn">
            Cerrar Sesión
          </button>
        </div>
      </div>
    </div>

    <div class="modal-overlay" id="add-user-modal">
      <div class="modal">
        <div class="modal-header">
          <h2 id="modal-title">Agregar Nuevo Usuario</h2>
          <button class="close-modal" id="close-modal">&times;</button>
        </div>
        <form id="user-form">
          <div style="padding: 24px">
            <div class="form-group">
              <label for="user-name">Nombre Completo</label>
              <input type="text" id="user-name" required />
            </div>
            <div class="form-group">
              <label for="user-email">Correo Electrónico</label>
              <input type="email" id="user-email" required />
            </div>
            <div class="form-group">
              <label for="user-role">Rol</label>
              <select id="user-role" required>
                <option value="">Seleccionar rol</option>
                <option value="admin">Administrador</option>
                <option value="editor">Editor</option>
                <option value="viewer">Viewer</option>
              </select>
            </div>
            <div class="form-actions">
              <button
                type="button"
                class="btn btn-secondary"
                id="cancel-user-btn"
              >
                Cancelar
              </button>
              <button type="submit" class="btn btn-primary">
                Crear Usuario
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <!-- Scripts de Módulos de Página -->
    <script src="js/pages/dashboard-page.js"></script>
    <script src="js/pages/products-page.js"></script>
    <script src="js/pages/categories-page.js"></script>
    <script src="js/pages/orders-page.js"></script>
    <script src="js/pages/customers-page.js"></script>
    <script src="js/pages/reports-page.js"></script>
    <script src="js/pages/settings-page.js"></script>

    <!-- Scripts de Módulos -->
    <script src="js/modules/profile-admin-module.js"></script>

    <script src="js/navigation-manager.js"></script>

    <script>
      // Funcionalidad del Header y Sidebar
      const mobileToggle = document.getElementById("mobile-nav-toggle");
      const sidebar = document.getElementById("sidebar");
      const sidebarToggle = document.getElementById("sidebar-toggle");

      mobileToggle?.addEventListener("click", () => {
        sidebar.classList.toggle("active");
      });

      sidebarToggle?.addEventListener("click", () => {
        sidebar.classList.remove("active");
      });

      const profileToggle = document.getElementById("profile-toggle");
      const profileDropdown = document.getElementById("profile-dropdown");

      profileToggle?.addEventListener("click", (e) => {
        e.stopPropagation();
        profileDropdown.classList.toggle("active");
      });

      document.addEventListener("click", (e) => {
        if (
          !profileDropdown?.contains(e.target) &&
          !profileToggle?.contains(e.target)
        ) {
          profileDropdown?.classList.remove("active");
        }
      });

      const userData = JSON.parse(sessionStorage.getItem("currentUser"));
      if (userData) {
        document.getElementById("profile-name").textContent =
          userData.username || "Administrador";
        document.getElementById("profile-email").textContent =
          userData.email || "admin@sistema.local";
      }

      const logoutBtn = document.getElementById("logout-btn");
      const logoutModal = document.getElementById("logout-modal");
      const logoutConfirmBtn = document.getElementById("logout-confirm-btn");
      const logoutCancelBtn = document.getElementById("logout-cancel-btn");

      function showLogoutModal() {
        logoutModal.classList.add("active");
      }

      function closeLogoutModal() {
        logoutModal.classList.remove("active");
      }

      function performLogout() {
        closeLogoutModal();
        const loadingOverlay = document.getElementById("logoutLoadingOverlay");
        if (loadingOverlay) {
          loadingOverlay.classList.remove("hidden");
        }
        setTimeout(() => {
          sessionStorage.removeItem("currentUser");
          sessionStorage.removeItem("loggedIn");
          localStorage.removeItem("darkMode");
          window.location.href = "index.html";
        }, 1000);
      }

      logoutBtn?.addEventListener("click", showLogoutModal);
      logoutConfirmBtn?.addEventListener("click", performLogout);
      logoutCancelBtn?.addEventListener("click", closeLogoutModal);
    </script>
  </body>
</html>
