<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Debug - Profile Button</title>
    <link rel="stylesheet" href="css/tienda-productos.css" />
    <style>
      body {
        font-family: monospace;
        background: #0f172a;
        color: #e2e8f0;
        padding: 20px;
      }
      .test-box {
        background: #1a2847;
        border: 1px solid #2d4a7c;
        border-radius: 8px;
        padding: 20px;
        margin: 20px 0;
      }
      .success {
        color: #10b981;
      }
      .error {
        color: #ef4444;
      }
      .warning {
        color: #f59e0b;
      }
      h2 {
        color: #6366f1;
      }
      button {
        background: #6366f1;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #818cf8;
      }
      pre {
        background: #0a0e27;
        padding: 10px;
        border-radius: 4px;
        overflow-x: auto;
      }
      #console-output {
        max-height: 400px;
        overflow-y: auto;
      }
    </style>
  </head>
  <body>
    <h1>üîç Test Debug - Profile Button Issue</h1>

    <div class="test-box">
      <h2>1. Elementos del DOM</h2>
      <div id="dom-test"></div>
      <button onclick="testDOM()">üîÑ Re-test DOM</button>
    </div>

    <div class="test-box">
      <h2>2. M√≥dulo JavaScript</h2>
      <div id="module-test"></div>
      <button onclick="testModule()">üîÑ Re-test Module</button>
    </div>

    <div class="test-box">
      <h2>3. CSS Styles</h2>
      <div id="css-test"></div>
      <button onclick="testCSS()">üîÑ Re-test CSS</button>
    </div>

    <div class="test-box">
      <h2>4. Simular Clicks</h2>
      <button onclick="simulateProfileClick()">
        üë§ Click en Profile Toggle
      </button>
      <button onclick="simulateLogoutClick()">üö™ Click en Logout Button</button>
      <div id="click-test"></div>
    </div>

    <div class="test-box">
      <h2>5. Console Output</h2>
      <button onclick="clearConsole()">üóëÔ∏è Clear Console</button>
      <pre id="console-output"></pre>
    </div>

    <!-- Estructura del perfil para probar -->
    <div style="position: relative; margin: 20px">
      <div class="profile-menu-container">
        <button class="profile-toggle" id="profile-toggle">
          <img
            src="https://i.pravatar.cc/150?u=test"
            alt="Avatar"
            class="profile-avatar"
          />
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <polyline points="6 9 12 15 18 9" />
          </svg>
        </button>

        <div class="profile-dropdown" id="profile-dropdown">
          <div class="profile-header">
            <img
              src="https://i.pravatar.cc/150?u=test"
              alt="Avatar"
              class="profile-avatar-large"
            />
            <div class="profile-info">
              <div class="profile-name" id="profile-name">Test User</div>
              <div class="profile-email" id="profile-email">
                test@example.com
              </div>
              <div class="profile-role">Cliente</div>
            </div>
          </div>
          <hr class="profile-divider" />
          <a href="#" class="profile-menu-item">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
              <circle cx="12" cy="7" r="4" />
            </svg>
            <span>Mi Perfil</span>
          </a>
          <hr class="profile-divider" />
          <button class="profile-menu-item logout-item" id="logout-btn">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
              <polyline points="16 17 21 12 16 7" />
              <line x1="21" y1="12" x2="9" y2="12" />
            </svg>
            <span>Cerrar Sesi√≥n</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Modal de logout -->
    <div class="modal-overlay" id="logout-modal">
      <div class="modal-content logout-modal">
        <div class="logout-modal-icon">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="64"
            height="64"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.5"
          >
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
            <polyline points="16 17 21 12 16 7" />
            <line x1="21" y1="12" x2="9" y2="12" />
          </svg>
        </div>
        <div class="logout-modal-content">
          <h2>¬øCerrar sesi√≥n?</h2>
          <p>Test modal de logout</p>
        </div>
        <div class="logout-modal-footer">
          <button class="btn btn-secondary" id="logout-cancel-btn">
            Cancelar
          </button>
          <button class="btn btn-danger logout-confirm" id="logout-confirm-btn">
            Cerrar Sesi√≥n
          </button>
        </div>
      </div>
    </div>

    <div class="loading-overlay hidden" id="logoutLoadingOverlay">
      <div class="loader">
        <span class="loader-ring"></span>
        <p class="loader-text">
          Cerrando Sesi√≥n<strong>por favor espera...</strong>
        </p>
      </div>
    </div>

    <script>
      // Capturar console.log
      const originalLog = console.log;
      const originalError = console.error;
      const originalWarn = console.warn;
      const consoleOutput = document.getElementById("console-output");

      function addToConsole(type, ...args) {
        const msg = args
          .map((arg) =>
            typeof arg === "object" ? JSON.stringify(arg, null, 2) : String(arg)
          )
          .join(" ");
        const timestamp = new Date().toLocaleTimeString();
        consoleOutput.textContent += `[${timestamp}] [${type}] ${msg}\n`;
        consoleOutput.scrollTop = consoleOutput.scrollHeight;
      }

      console.log = function (...args) {
        originalLog.apply(console, args);
        addToConsole("LOG", ...args);
      };

      console.error = function (...args) {
        originalError.apply(console, args);
        addToConsole("ERROR", ...args);
      };

      console.warn = function (...args) {
        originalWarn.apply(console, args);
        addToConsole("WARN", ...args);
      };

      function clearConsole() {
        consoleOutput.textContent = "";
      }

      function testDOM() {
        const container = document.getElementById("dom-test");
        container.innerHTML = "<h3>Verificando elementos...</h3>";

        const elements = {
          "profile-toggle": document.getElementById("profile-toggle"),
          "profile-dropdown": document.getElementById("profile-dropdown"),
          "logout-btn": document.getElementById("logout-btn"),
          "logout-modal": document.getElementById("logout-modal"),
          "logout-confirm-btn": document.getElementById("logout-confirm-btn"),
          "logout-cancel-btn": document.getElementById("logout-cancel-btn"),
          logoutLoadingOverlay: document.getElementById("logoutLoadingOverlay"),
        };

        let html = "<ul>";
        for (const [id, element] of Object.entries(elements)) {
          if (element) {
            html += `<li class="success">‚úì ${id}: ENCONTRADO</li>`;
            console.log(`‚úì ${id}: ENCONTRADO`, element);
          } else {
            html += `<li class="error">‚úó ${id}: NO ENCONTRADO</li>`;
            console.error(`‚úó ${id}: NO ENCONTRADO`);
          }
        }
        html += "</ul>";
        container.innerHTML += html;
      }

      function testModule() {
        const container = document.getElementById("module-test");
        container.innerHTML = "<h3>Verificando m√≥dulo...</h3>";

        let html = "<ul>";

        // Intentar importar el m√≥dulo
        import("./js/modules/user-shop-module.js")
          .then((module) => {
            html += '<li class="success">‚úì M√≥dulo importado correctamente</li>';
            html +=
              '<li class="success">‚úì initUserShop disponible: ' +
              (typeof module.initUserShop === "function") +
              "</li>";

            if (typeof module.initUserShop === "function") {
              try {
                module.initUserShop();
                html += '<li class="success">‚úì initUserShop() ejecutado</li>';
              } catch (error) {
                html += `<li class="error">‚úó Error al ejecutar initUserShop(): ${error.message}</li>`;
                console.error("Error al ejecutar initUserShop():", error);
              }
            }

            html += "</ul>";
            container.innerHTML += html;
          })
          .catch((error) => {
            html += `<li class="error">‚úó Error al importar m√≥dulo: ${error.message}</li>`;
            html += "</ul>";
            container.innerHTML += html;
            console.error("Error al importar m√≥dulo:", error);
          });
      }

      function testCSS() {
        const container = document.getElementById("css-test");
        container.innerHTML = "<h3>Verificando estilos...</h3>";

        const elements = {
          "profile-toggle": document.getElementById("profile-toggle"),
          "profile-dropdown": document.getElementById("profile-dropdown"),
        };

        let html = "<ul>";

        if (elements["profile-toggle"]) {
          const styles = window.getComputedStyle(elements["profile-toggle"]);
          html += `<li>profile-toggle display: <span class="${
            styles.display === "flex" ? "success" : "warning"
          }">${styles.display}</span></li>`;
          html += `<li>profile-toggle cursor: <span class="${
            styles.cursor === "pointer" ? "success" : "warning"
          }">${styles.cursor}</span></li>`;
        }

        if (elements["profile-dropdown"]) {
          const styles = window.getComputedStyle(elements["profile-dropdown"]);
          html += `<li>profile-dropdown display: <span class="${
            styles.display === "none" ? "success" : "warning"
          }">${styles.display}</span></li>`;
          html += `<li>profile-dropdown position: <span class="${
            styles.position === "absolute" ? "success" : "warning"
          }">${styles.position}</span></li>`;
        }

        html += "</ul>";
        container.innerHTML += html;
      }

      function simulateProfileClick() {
        const container = document.getElementById("click-test");
        const toggle = document.getElementById("profile-toggle");
        const dropdown = document.getElementById("profile-dropdown");

        if (toggle) {
          console.log("üîµ Simulando click en profile-toggle...");
          toggle.click();

          setTimeout(() => {
            const isActive = dropdown.classList.contains("active");
            container.innerHTML = `<p class="${isActive ? "success" : "error"}">
                        Dropdown ${isActive ? "ABIERTO ‚úì" : "CERRADO ‚úó"}
                    </p>`;
            console.log("Dropdown active:", isActive);
          }, 100);
        } else {
          container.innerHTML =
            '<p class="error">‚úó profile-toggle no encontrado</p>';
        }
      }

      function simulateLogoutClick() {
        const container = document.getElementById("click-test");
        const logoutBtn = document.getElementById("logout-btn");
        const modal = document.getElementById("logout-modal");

        if (logoutBtn) {
          console.log("üîµ Simulando click en logout-btn...");
          logoutBtn.click();

          setTimeout(() => {
            const isActive = modal.classList.contains("active");
            container.innerHTML = `<p class="${isActive ? "success" : "error"}">
                        Modal de logout ${isActive ? "ABIERTO ‚úì" : "CERRADO ‚úó"}
                    </p>`;
            console.log("Modal active:", isActive);
          }, 100);
        } else {
          container.innerHTML =
            '<p class="error">‚úó logout-btn no encontrado</p>';
        }
      }

      // Auto-test al cargar
      window.addEventListener("DOMContentLoaded", () => {
        console.log("üöÄ P√°gina cargada, iniciando tests...");
        testDOM();
        testModule();
        testCSS();
      });
    </script>
  </body>
</html>
